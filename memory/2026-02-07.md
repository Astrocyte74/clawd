# 2026-02-07 - Session Summary

## Z-Image API Discovery

**Major breakthrough:** Successfully tested Z-Image API running on localhost:8000 via Tailscale.

### API Endpoints Discovered

1. **GET /api/recipes** — Returns 90+ image generation recipes organized into 10 groups:
   - Miniature Worlds
   - Portraits & Characters
   - Product & Branding
   - Photography
   - Artistic Styles
   - Infographics
   - Quick Prompts
   - Creative Concepts
   - Travel & Places
   - Developer

2. **POST /api/generate** — Image generation endpoint
   - Parameters: `prompt`, `generator` (zimage), `advanced` (options)
   - Image generation time: 20-30 seconds for 768×768 images
   - 4 steps ≈ 20s, 7 steps ≈ 40s

### Successful Tests

Generated two images:
1. **Mountain landscape** — "A serene mountain landscape at sunset"
2. **Cat image** — "A cat wearing sunglasses"

Both generated successfully in ~20-30 seconds.

### Interesting Recipes Found

- **Trojan Horse Enters Troy** — Google Street View style with privacy blur
- **Living Passport of Worlds** — Visa stamps transform into 3D cities
- **Historical Event Street View** — 360° panoramas of historical events
- **Spaghetti Western Worlds** — Everything made of pasta
- **Cats in Hats Tour** — Countries as cats in appropriate headwear

### Tailscale Configuration

- Backend: `localhost:8000`
- Tailscale IP: Dynamic (was 100.101.80.13, changed to 100.83.81.85)
- CORS: Pre-configured for `http://100.*` IPs
- Get current IP: `/Applications/Tailscale.app/Contents/MacOS/Tailscale status | grep "100\."`

## Project Status

### Completed
- [x] Z-Image API integration tested and working
- [x] Tailscale connectivity verified
- [x] Image generation tested (successful)
- [x] API recipes documented

### Next Steps
- [ ] Set up Z-Image as background service (launchd)
- [ ] Generate images for Clawd Hub pages
- [ ] Create page showcasing interesting recipes
- [ ] Document full API in TAILSCALE.md

## Clawd Hub Pages Created

1. **SLS vs Starship** (`/sls-vs-starship/`)
2. **Best Marathon Running Shoes 2026** (`/best-marathon-shoes-2026/`)
3. **Hoka Mach 7 Review** (`/hoka-mach-7-review/`)
4. **Plants That Touch Are More Resilient** (`/plant-touch-communication/`)

## Key Learnings

- Z-Image API is **fully functional** and ready for content creation
- Recipe system provides **90+ pre-built prompts** for consistent results
- Tailscale IPs are **dynamic** — always check current IP before API calls
- Image generation is **slow but reliable** (20-30 seconds per image)
- CORS is pre-configured for Tailscale IPs

## Technical Notes

- Z-Image backend location: `/Users/markdarby16/clawd/projects/clawd-hub/backend/`
- Start command: `cd backend && python3 main.py`
- Python environment: `venv/` in project directory
- Dependencies: Flask, flask-cors, torch, diffusers, transformers

---
*Session context stored for post-compaction recovery*

## Developer Recipe System Discovery (February 7, 2026 - Evening)

**Major breakthrough:** Discovered and tested the **developer recipe system** for ultra-fast icon generation!

### Recipe System vs Standard Generation

**Standard Generation (Full Prompt):**
- Database icon: 22.3s (768×768, 4 steps)
- Cloud upload icon: 43.1s (768×768, 4 steps)
- **Baseline:** 20-45 seconds depending on complexity

**Recipe System (Optimized):**
- Blue rocket (icon-256): **5.9s** ⚡⚡⚡
- Settings gear (web-graphic-256): **6.0s** ⚡⚡⚡
- Lightning bolt (icon-384): **8.6s** ⚡⚡
- Heart (icon-512): **15.8s** ⚡

**Speedup: 3-4× faster** using recipes!

### Developer Recipes Tested

| Recipe ID | Size | Steps | Time | Best For |
|-----------|------|-------|------|----------|
| `icon-256` | 256×256 | 4 | ~6s | Favicons, small icons |
| `web-graphic-256` | 256×256 | 4 | ~6s | Simple web graphics |
| `icon-384` | 384×384 | 4 | ~9s | UI icons, buttons |
| `icon-512` | 512×512 | 5 | ~16s | High-res icons, retina |

### Recipe System Benefits

1. **Ultra-fast generation** — 6 seconds vs 22+ seconds
2. **Consistent flat vector style** — "solid fill, clean thick outline, centred, no gradients, no shadow, white background"
3. **Auto-negative prompts** — "photo, realistic, 3d render, gradient, shadow, messy lines, complex details"
4. **Optimized sizes** — Right dimensions for each use case
5. **White backgrounds** — Easy to remove/mask for transparency

### Usage Example

```bash
# Get current Tailscale IP
TS_IP=$(/Applications/Tailscale.app/Contents/MacOS/Tailscale status | grep "100\." | awk '{print $1}' | head -1)

# Generate icon using recipe
curl -X POST http://${TS_IP}:8000/api/generate \
  -H "Content-Type: application/json" \
  -d '{
    "prompt": "blue rocket",
    "recipe_id": "icon-256",
    "advanced": {}
  }'
```

### What the Recipe System Does

1. Takes your subject (e.g., "blue rocket")
2. Adds the recipe's prompt template automatically
3. Applies the recipe's negative prompt
4. Uses the optimized size and steps
5. Returns a clean, flat vector-style icon

### Documentation Updated

- **MEMORY.md** — Added developer recipes section with speed comparison table
- **TAILSCALE.md** — Added recipe system usage examples and troubleshooting

### Recommendations

**Use recipes for:**
- Favicons (icon-256, ~6s)
- UI icons (icon-384, ~9s)
- Simple graphics (web-graphic-256, ~6s)

**Use standard generation for:**
- Complex scenes
- Illustrations
- Custom styles
- Large images (1024×1024+)

### Key Insight

The recipe system is **clearly optimized for rapid icon generation**. Perfect for bulk creating UI assets, favicons, and web graphics!

## Critical Lesson: Z-Image API Access (February 7, 2026 - Late Evening)

**THE MISTAKE I KEEP MAKING:**

I repeatedly try to access the Z-Image API using:
- ❌ `localhost:8000` — Fails because I'm in wrong directory (workspace, not backend)
- ❌ Hardcoded IPs like `100.101.80.13` — IPs go stale when Tailscale reconnects
- ❌ Old IPs from memory — Tailscale IPs are DYNAMIC and change

**THE CORRECT WAY:**

```bash
# Step 1: ALWAYS get current Tailscale IP
TS_IP=$(/Applications/Tailscale.app/Contents/MacOS/Tailscale status | grep "100\." | awk '{print $1}' | head -1)

# Step 2: Verify backend is running
curl http://${TS_IP}:8000/health

# Step 3: Use the variable in API calls
curl -X POST http://${TS_IP}:8000/api/generate \
  -H "Content-Type: application/json" \
  -d '{"prompt": "blue rocket", "recipe_id": "icon-256", "advanced": {}}'
```

**WHY THIS HAPPENS:**
- Workspace directory: `~/.openclaw/workspace/`
- Backend directory: `/Users/markdarby16/clawd/projects/clawd-hub/backend/`
- Tailscale IPs: **Dynamic** — change on reconnect/restart

**LESSON LEARNED:**
1. Never hardcode Tailscale IPs
2. Always use the grep command to get current IP
3. Check `/health` endpoint before generation
4. Use `${TS_IP}` variable in all curl commands

**Updated MEMORY.md with:**
- Correct API usage pattern
- Common mistakes section
- Warnings about dynamic IPs

## Z-Image Transparency Discovery (February 7, 2026 - Late Night)

**THE BREAKTHROUGH:**

Mark tested a simple star icon using the recipe system and discovered it was **truly transparent**! This revealed the critical difference between using `recipe_id` vs `generator` directly.

**What I Did Wrong:**

```json
// ❌ WRONG - Using generator directly
{
  "generator": "zimage",
  "prompt": "...transparent background...",
  "advanced": {"width": 256, "height": 256, "steps": 4}
}
```
- Model ignores "transparent background" in prompt
- Results in white/solid backgrounds
- Must manually post-process

**What Works:**

```json
// ✅ CORRECT - Using recipe_id
{
  "prompt": "blue rocket",
  "recipe_id": "icon-256",
  "advanced": {}
}
```
- **Automatic transparency** via recipe post-processing!
- Clean alpha channel
- Smaller file sizes

**Why This Works:**

The Z-Image recipe system includes a **post-processing step** that converts white/colored backgrounds to transparent after image generation. When you use `generator: "zimage"` directly, you bypass this step.

**Evidence:**

| Method | Background | File Size | Result |
|--------|-----------|-----------|--------|
| `generator: "zimage"` | White/solid | Larger | ❌ Not transparent |
| `recipe_id: "icon-256"` | Transparent | Smaller | ✅ Works! |

**Test Results:**

Plant icon regeneration using `recipe_id`:
- Leaf: 37 KB (was 34 KB)
- Seedling: 25 KB (was 35 KB) - **10 KB smaller!**
- DNA: 24 KB (was 33 KB) - **9 KB smaller!**
- Sun: 34 KB (was 45 KB) - **11 KB smaller!**
- Network: 31 KB (was 32 KB)
- Shield: 35 KB (was 39 KB)

**Total savings:** ~36 KB with proper transparency!

**Lesson Learned:**

> **ALWAYS use `recipe_id` for icons — NEVER use `generator` directly unless you want solid backgrounds.**

The recipe system's post-processing is the key to getting transparent backgrounds!
