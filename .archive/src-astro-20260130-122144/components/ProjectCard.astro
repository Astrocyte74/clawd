---
// ProjectCard.astro - Individual project card component with 3D tilt effect
interface Props {
  title: string;
  description: string;
  category: string;
  categoryIcon: string;
  href: string;
  date: string;
  metadata?: Array<{ icon: string; label: string }>;
  delay?: string;
}

const {
  title,
  description,
  category,
  categoryIcon,
  href,
  date,
  metadata = [],
  delay = '0',
} = Astro.props;
---

<a
  href={href}
  class="tilt-card group relative overflow-hidden rounded-2xl border border-border/50 bg-card p-6 transition-all duration-300 hover:shadow-2xl hover:shadow-primary/20 hover:border-primary/30 animate-fade-in opacity-0 shimmer"
  style="animation-delay: {delay}s"
  data-tilt
>
  <!-- Hover gradient background -->
  <div class="absolute inset-0 bg-gradient-to-br from-primary/5 via-purple-500/5 to-pink-500/5 opacity-0 transition-opacity duration-300 group-hover:opacity-100 dark:from-primary/10 dark:via-purple-500/10 dark:to-pink-500/10"></div>

  <!-- Top gradient line -->
  <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-primary via-purple-500 to-pink-500 opacity-0 transition-opacity duration-300 group-hover:opacity-100"></div>

  <!-- Glow effect container -->
  <div class="tilt-glow absolute inset-0 rounded-2xl opacity-0 transition-opacity duration-300 group-hover:opacity-100 pointer-events-none"
       style="background: radial-gradient(600px circle at var(--mouse-x, 50%) var(--mouse-y, 50%), hsla(var(--primary), 0.15), transparent 40%);">
  </div>

  <!-- Content -->
  <div class="relative tilt-content">
    <!-- Category badge -->
    <div class="mb-4 inline-flex items-center gap-1.5 rounded-full bg-primary/10 px-3 py-1.5 text-xs font-semibold text-primary ring-1 ring-inset ring-primary/20 transition-all duration-300 group-hover:bg-primary/20 group-hover:ring-primary/40 group-hover:scale-105">
      <span>{categoryIcon}</span>
      <span>{category}</span>
    </div>

    <!-- Title -->
    <h3 class="text-xl sm:text-2xl font-bold mb-3 group-hover:text-primary transition-colors duration-300">
      {title}
    </h3>

    <!-- Description -->
    <p class="text-muted-foreground mb-4 line-clamp-3 leading-relaxed">
      {description}
    </p>

    <!-- Metadata -->
    <div class="flex flex-wrap items-center gap-3 sm:gap-4 mb-4 text-sm text-muted-foreground">
      <!-- Date -->
      <div class="flex items-center gap-1.5">
        <svg
          class="h-4 w-4 transition-transform duration-300 group-hover:scale-110"
          xmlns="http://www.w3.org/2000/svg"
          fill="none"
          viewBox="0 0 24 24"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
            stroke-linecap="round"
            stroke-linejoin="round"
          />
        </svg>
        <span>{date}</span>
      </div>

      <!-- Additional metadata -->
      {
        metadata.map((item) => (
          <div class="flex items-center gap-1.5">
            <svg
              class="h-4 w-4 transition-transform duration-300 group-hover:scale-110"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d={item.icon}
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
            <span>{item.label}</span>
          </div>
        ))
      }
    </div>

    <!-- CTA -->
    <div class="flex items-center gap-2 text-sm font-semibold text-primary group-hover:gap-3 transition-all duration-300">
      <span>View Report</span>
      <svg
        class="h-4 w-4 transition-transform duration-300 group-hover:translate-x-1 group-hover:scale-110"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          d="M17 8l4 4m0 0l-4 4m4-4H3"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </div>
  </div>
</a>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  /* 3D Tilt Effect */
  .tilt-card {
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .tilt-card:hover {
    transform: translateY(-4px) rotateX(var(--rotate-x, 0deg)) rotateY(var(--rotate-y, 0deg));
  }

  .tilt-content {
    transform: translateZ(20px);
  }

  /* Reduce tilt on mobile */
  @media (max-width: 768px) {
    .tilt-card:hover {
      transform: translateY(-4px);
    }
  }

  /* Respect prefers-reduced-motion */
  @media (prefers-reduced-motion: reduce) {
    .tilt-card:hover {
      transform: translateY(-4px);
    }
  }
</style>

<script>
  // 3D Tilt Effect
  document.querySelectorAll('.tilt-card[data-tilt]').forEach(card => {
    const updateTilt = (e) => {
      const rect = card.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      const centerX = rect.width / 2;
      const centerY = rect.height / 2;
      const rotateX = (y - centerY) / 10;
      const rotateY = (centerX - x) / 10;

      card.style.setProperty('--rotate-x', `${rotateX}deg`);
      card.style.setProperty('--rotate-y', `${rotateY}deg`);
      card.style.setProperty('--mouse-x', `${x}px`);
      card.style.setProperty('--mouse-y', `${y}px`);
    };

    const resetTilt = () => {
      card.style.setProperty('--rotate-x', '0deg');
      card.style.setProperty('--rotate-y', '0deg');
    };

    card.addEventListener('mousemove', updateTilt);
    card.addEventListener('mouseleave', resetTilt);
  });
</script>
